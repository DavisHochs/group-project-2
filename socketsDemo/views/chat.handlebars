<div class='container'>
    <h1>{{roomName}}</h1>
    <ul id='chat-box'>
        {{#each messages}}
        <li class='card'>
            <div class='card-content'>
                {{user}}: {{content}}
            </div>
        </li>
        {{/each}}
    </ul>
    <form id='chat-submission'>
        <div class='row input-field'>
            <input class='validate' type='text' name='user' id='user'>
            <label class='active' for='user'>User</label>
        </div>
        <div class='row input-field'>    
            <input class='validate' type='text' name='message' id='message'>
            <label class='active' for='message'>Message</label>
        </div>
        <div class='row'>
            <blockquote id='currently-typing'></blockquote>
        </div>
        <div class='row input-field'>
            <button type='submit' class='btn' name='send-button' id='send-button'>SUBMIT</button>
        </div>
    </form>
</div>
<script>
    $(function() {
        
        // Toggle Materialize input labels
        M.updateTextFields();

        // Initialize socket connection
        const socket = io('http://localhost:3000');
        socket.on('connect', function() {

            console.log('Client socket connected');

            // Client-side new message listener
            socket.on('new message', function(newMessage) {

                console.log('New message:', newMessage);
                const {user, message} = newMessage;

                // Reset user typing message if message not from client user
                // if (user !== clientUser) {
                    $('#currently-typing').text('');
                // };

                // Add new chat message card to chat box
                $('#chat-box').html($('#chat-box').html() + `<li class='card'><div class='card-content'>${user}: ${message}</div></li>`);
            
            });

            // Client-side listener for other users typing event
            socket.on('typing', function(typingUser) {

                console.log(typingUser, 'is typing');

                // Update currently typing notification
                $('#currently-typing').text(`${typingUser} is currently typing`);

            })
        });

        // Handler for new message form submission
        $('#chat-submission').submit(function(e) {

            e.preventDefault();

            // Assemble message data and emit as new message event
            const data = {
                user: $('#user').val(),
                message: $('#message').val()
            };
            socket.emit('new message', data);

        });

        // Handler for user typing event
        $('#message').keyup(function(e) {

            e.preventDefault();
            console.log('keyup fired');

            // Emit typing event with user name
            socket.emit('typing', $('#user').val());
        });
    });
</script>